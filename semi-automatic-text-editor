#! /bin/sh

FILE=$1
LINE_INDICATOR=$2
INSERT_TEXT=$3
OFFSET=$4

if [ ! -f $FILE ]
then
  echo "ERROR: \"$FILE\" dosen't exist!" 2>&1
  exit 1
fi

# LINE=$(cat $FILE | grep "$LINE_INDICATOR" -n | awk -F':' {'print $1'})
LINE=$(cat $FILE | grep "$LINE_INDICATOR" -n | cut -d ':' -f 1)
if [ ! $LINE ]
then
  echo "ERROR: \"$LINE_INDICATOR\" line dosen't exist!" 2>&1
  exit 2
fi

cat $FILE | grep "$INSERT_TEXT" > /dev/null
if [ $? -eq 0 ]
then
  echo "ERROR: \"$INSERT_TEXT\" is already inserted!" 2>&1
  exit 3
fi

if [ $OFFSET ]
then
  LINE=$(( $LINE + $OFFSET ))
fi
if [ $LINE -lt 0 ]
then
  echo 'ERROR: LINE became negative!' 2>&1
  exit 4
fi
if [ $LINE -gt $(cat $FILE | wc -l) ]
then
  echo "ERROR: LINE was over the number of lines of \"$FILE\"" 2>&1
  exit 4
fi

ed $FILE << EOS
$LINE
i
$INSERT_TEXT
.
w
q
EOS
